<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Seller Signup - Google Maps with Barangay</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 15px;
        }
        #locationResult {
            padding: 10px;
            background-color: #f0f8ff;
            border: 1px solid #007bff;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>

    <form id="signupForm" action="your-signup-process.php" method="POST">

        <input type="text" name="name" placeholder="Seller Name"><br><br>
        <input type="email" name="email" placeholder="Email"><br><br>
    
        <!-- Hidden fields for latitude, longitude, and address -->
        <input type="hidden" name="latitude" id="latitude">
        <input type="hidden" name="longitude" id="longitude">
        <input type="hidden" name="barangay_address" id="barangay_address">
    
        <h3>Pin your Shop Location:</h3>
        <div id="map"></div>
    
        <button type="submit">Sign Up</button>
    
        <div id="locationResult"></div>
    
    </form>
    
    <style>
        #map {
            height: 400px;
            width: 100%;
            margin-bottom: 15px;
        }
        #locationResult {
            padding: 10px;
            background-color: #f0f8ff;
            border: 1px solid #007bff;
            margin-top: 10px;
            display: none;
        }
    </style>
    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDsyCZpAJ4FEq6CxKn97q8oNdhyUsUxvFc&callback=initMap" async defer></script>
    
    <script>
    var map, marker, geocoder;
    
    
    function initMap() {
        var defaultLocation = { lat: 14.682682854232228, lng: 120.53848458884082 }; 
    
        map = new google.maps.Map(document.getElementById('map'), {
            center: defaultLocation,
            zoom: 13
        });
    
        geocoder = new google.maps.Geocoder();
    
        marker = new google.maps.Marker({
            position: defaultLocation,
            map: map,
            draggable: true
        });
    
        updateLocation(marker.getPosition());
    
        marker.addListener('dragend', function() {
            updateLocation(marker.getPosition());
        });
    
        map.addListener('click', function(event) {
            marker.setPosition(event.latLng);
            updateLocation(event.latLng);
        });
    
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                map.setCenter(userLocation);
                marker.setPosition(userLocation);
                updateLocation(marker.getPosition());
            }, function() {
                alert('Error: Location service failed or blocked.');
            });
        } else {
            alert('Error: Your browser does not support geolocation.');
        }
    }
    
    // Update lat/lng and address
    function updateLocation(latLng) {
        document.getElementById('latitude').value = latLng.lat();
        document.getElementById('longitude').value = latLng.lng();
    
        geocoder.geocode({ location: latLng }, function(results, status) {
            if (status === 'OK') {
                if (results[0]) {
                    var addressComponents = results[0].address_components;
                    var barangay = '';
    
                    for (var i = 0; i < addressComponents.length; i++) {
                        var types = addressComponents[i].types;
    
                        if (types.includes('sublocality_level_1') || 
                            types.includes('sublocality_level_2') || 
                            types.includes('neighborhood') ||
                            (types.includes('political') && types.includes('sublocality')) ||
                            types.includes('administrative_area_level_3')) {
    
                            barangay = addressComponents[i].long_name;
                            break;
                        }
                    }
    
                    if (barangay) {
                        document.getElementById('barangay_address').value = barangay;
                    } else {
                        document.getElementById('barangay_address').value = "No barangay found";
                    }
                } else {
                    console.error('No address found');
                }
            } else {
                console.error('Geocoder failed: ' + status);
            }
        });
    }
    
    // Show result on signup button click
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('signupForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent real submit for now
    
            var latitude = document.getElementById('latitude').value;
            var longitude = document.getElementById('longitude').value;
            var barangay = document.getElementById('barangay_address').value;
    
            var resultBox = document.getElementById('locationResult');
            resultBox.innerHTML = `
                <strong>Pinned Location:</strong><br>
                Latitude: ${latitude}<br>
                Longitude: ${longitude}<br>
                <strong>Barangay Address:</strong><br>
                ${barangay}`;
            resultBox.style.display = 'block';
        });
    });
    </script>
    
</body>
</html>
